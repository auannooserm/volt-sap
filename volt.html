<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>‡πÇ‡∏´‡∏ß‡∏ï‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@400;600&display=swap');
  body {
    font-family: 'Kanit', sans-serif;
    background: linear-gradient(135deg, #74ebd5, #ACB6E5);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 15px;
  }
  .container {
    background: #fff;
    padding: 30px 25px;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    width: 100%;
    max-width: 420px;
    text-align: center;
  }
  h2 { color: #333; font-size: 1.5em; margin-bottom: 15px; }
  button {
    width: 100%; padding: 14px 0; margin: 10px 0; border: none;
    border-radius: 10px; font-size: 1rem; cursor: pointer;
    transition: all 0.3s ease; font-weight: 600;
  }
  button:hover { transform: scale(1.03); opacity: 0.95; }
  .team-btn { background: #7097c5; color: #fff; }
  .solo-btn { background: #F4A261; color: #fff; }
  .admin-btn { background: #6C63FF; color: #fff; }
  .option-team { background: #7d92c7; color: #fff; }
  .option-solo { background: #A6C3E4; color: #fff; }
  .bar { height: 28px; border-radius: 8px; margin: 10px 0; color: white;
         line-height: 28px; padding-left: 10px; font-weight: 600;
         transition: width 0.5s ease; font-size: 0.9rem; }
  .bar-container { background: #e9ecef; border-radius: 8px; overflow: hidden; }
  #votePageTeam,#votePageSolo,#thankYou,#resultsPage,#adminPanel,#adminResults { display:none; }
  #pollStatusText { margin-top: 10px; font-weight: 600; }
  @media (max-width:480px){ .container{padding:25px 20px;} h2{font-size:1.3em;} }
</style>
</head>
<body>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -->
<div id="homePage" class="container">
  <h2>‡πÇ‡∏´‡∏ß‡∏ï‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢ ü•∞</h2>
  <button class="team-btn" onclick="showTeam()">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏°</button>
  <button class="solo-btn" onclick="showSolo()">‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</button>
  <button class="admin-btn" onclick="promptAdmin()">Admin</button>
  <p id="onlineCount" style="margin-top:10px;color:#2a9d8f;font-weight:600;"></p>
  <p id="pollStatusText"></p>
</div>

<!-- ‡πÇ‡∏´‡∏ß‡∏ï‡∏ó‡∏µ‡∏° -->
<div id="votePageTeam" class="container">
  <h2>‡πÇ‡∏´‡∏ß‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏°</h2>
  <button class="option-team" onclick="vote('‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏≠‡∏ô‡∏≠‡∏±‡∏ß')">‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏≠‡∏ô‡∏≠‡∏±‡∏ß</button>
  <button class="option-team" onclick="vote('‡∏ó‡∏µ‡∏°‡∏™‡∏ß‡∏¢‡πÉ‡∏´‡πâ 5 ‡∏°‡∏±‡πà‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ 10')">‡∏ó‡∏µ‡∏°‡∏™‡∏ß‡∏¢‡πÉ‡∏´‡πâ 5 ‡∏°‡∏±‡πà‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ 10</button>
  <button class="option-team" onclick="vote('‡∏ó‡∏µ‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏†‡∏≤‡∏û‡∏Å‡∏ê‡∏¥‡∏ô')">‡∏ó‡∏µ‡∏°‡πÄ‡∏à‡πâ‡∏≤‡∏†‡∏≤‡∏û‡∏Å‡∏ê‡∏¥‡∏ô</button>
  <button class="option-team" onclick="vote('‡∏ó‡∏µ‡∏°‡∏Ñ‡∏ô‡∏î‡∏µ‡πÑ‡∏°‡πà‡∏´‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏¥‡∏ô')">‡∏ó‡∏µ‡∏°‡∏Ñ‡∏ô‡∏î‡∏µ‡πÑ‡∏°‡πà‡∏´‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏¥‡∏ô</button>
  <button class="admin-btn" onclick="backHome()">‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<!-- ‡πÇ‡∏´‡∏ß‡∏ï‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß -->
<div id="votePageSolo" class="container">
  <h2>‡πÇ‡∏´‡∏ß‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</h2>
  <div id="soloButtons"></div>
  <button class="admin-btn" onclick="backHome()">‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<!-- ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì -->
<div id="thankYou" class="container">
  <h2>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï! üòä</h2>
  <button class="admin-btn" onclick="backHome()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
</div>

<!-- ‡∏ú‡∏•‡πÇ‡∏´‡∏ß‡∏ï -->
<div id="resultsPage" class="container">
  <h2>‡∏ú‡∏•‡πÇ‡∏´‡∏ß‡∏ï‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢</h2>
  <div id="resultBars"></div>
  <button class="admin-btn" onclick="backHome()">‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<!-- Admin -->
<div id="adminPanel" class="container">
  <h2>Admin Panel</h2>
  <button class="admin-btn" onclick="adminOpenPoll()">‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏ß‡∏ï</button>
  <button class="admin-btn" onclick="adminClosePoll()">‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏ß‡∏ï</button>
  <button class="admin-btn" onclick="showAdminResults()">‡∏î‡∏π‡∏ú‡∏•‡πÇ‡∏´‡∏ß‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  <button class="admin-btn" onclick="adminResetPoll()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÇ‡∏û‡∏• (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà)</button>
  <button class="admin-btn" onclick="closeAdminPanel()">‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<!-- ‡∏ú‡∏•‡∏£‡∏ß‡∏° Admin -->
<div id="adminResults" class="container">
  <h2>‡∏ú‡∏•‡πÇ‡∏´‡∏ß‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
  <h3 style="color:#457B9D;">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏°</h3>
  <div id="adminResultTeam"></div>
  <h3 style="color:#E76F51;margin-top:25px;">‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</h3>
  <div id="adminResultSolo"></div>
  <button class="admin-btn" onclick="backToAdmin()">‡∏Å‡∏•‡∏±‡∏ö</button>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// === CONFIG ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ===
const firebaseConfig = {
  apiKey: "AIzaSyC_AHNf_oRZ08m7gyjVyAo3jF3wotaLV1c",
  authDomain: "sap-vote.firebaseapp.com",
  databaseURL: "https://sap-vote-default-rtdb.firebaseio.com",
  projectId: "sap-vote",
  storageBucket: "sap-vote.firebasestorage.app",
  messagingSenderId: "377408911688",
  appId: "1:377408911688:web:81e1764675c58697e19b7d",
  measurementId: "G-Y64D0LFFLP"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let pollOpen = true;
let pollRound = null; // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≠‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
const ADMIN_PASSWORD = "t1234";

// === ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πâ‡∏≤ ===
function hideAll(){
  ['homePage','votePageTeam','votePageSolo','thankYou','resultsPage','adminPanel','adminResults']
    .forEach(id=>document.getElementById(id).style.display='none');
}
function backHome(){ hideAll(); document.getElementById('homePage').style.display='block'; }

// === ‡πÇ‡∏´‡∏°‡∏î‡πÇ‡∏´‡∏ß‡∏ï ===
function showTeam(){ hideAll(); localStorage.setItem('currentMode','team'); document.getElementById('votePageTeam').style.display='block'; }
function showSolo(){
  hideAll(); localStorage.setItem('currentMode','solo');
  const soloDiv=document.getElementById('soloButtons');
  soloDiv.innerHTML="";
  for(let i=1;i<=10;i++){
    const key="‡πÄ‡∏ö‡∏≠‡∏£‡πå "+i;
    const btn=document.createElement('button');
    btn.className='option-solo';
    btn.textContent=key;
    btn.onclick=()=>vote(key);
    soloDiv.appendChild(btn);
  }
  document.getElementById('votePageSolo').style.display='block';
}

// === ‡πÇ‡∏´‡∏ß‡∏ï ===
function vote(option){
  if(!pollOpen){ alert("‡πÇ‡∏´‡∏ß‡∏ï‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö"); return; }
  const mode=localStorage.getItem('currentMode');
  if(mode==='team' && localStorage.getItem('votedTeam')){ alert("‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß"); return; }
  if(mode==='solo' && localStorage.getItem('votedSolo')){ alert("‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß"); return; }

  const path = mode==='team' ? 'votesTeam/'+option : 'votesSolo/'+option;
  db.ref(path).transaction(v => (v || 0) + 1);

  if(mode==='team') localStorage.setItem('votedTeam','true');
  else localStorage.setItem('votedSolo','true');

  hideAll(); document.getElementById('thankYou').style.display='block';
}

// === ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÇ‡∏´‡∏ß‡∏ï ===
function displayResults(type, containerId){
  const ref = type==='team' ? db.ref('votesTeam') : db.ref('votesSolo');
  const container=document.getElementById(containerId);
  container.innerHTML="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...";
  ref.once('value', snapshot => {
    const data = snapshot.val() || {};
    const total = Object.values(data).reduce((a,b)=>a+b,0);
    container.innerHTML="";
    for(let opt in data){
      const pct= total===0?0:Math.round((data[opt]/total)*100);
      const color = type==='team' ? '#457B9D' : '#E76F51';
      container.innerHTML += `
        <div style="text-align:left;margin-top:10px;">${opt}</div>
        <div class="bar-container">
          <div class="bar" style="background:${color};width:${pct}%">${data[opt]} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (${pct}%)</div>
        </div>`;
    }
  });
}

// === Admin ===
function promptAdmin(){
  const pass=prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ Admin:");
  if(pass===ADMIN_PASSWORD){ hideAll(); document.getElementById('adminPanel').style.display='block'; }
  else if(pass!==null){ alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); }
}
function closeAdminPanel(){ backHome(); }

function adminOpenPoll(){
  pollOpen=true;
  db.ref('pollStatus/open').set(true);
  alert("‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß");
}

function adminClosePoll(){
  pollOpen=false;
  db.ref('pollStatus/open').set(false);
  alert("‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß");
}

function adminResetPoll(){
  if(confirm("‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÇ‡∏û‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")){
    const newRound = Date.now(); // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà
    db.ref('votesTeam').remove();
    db.ref('votesSolo').remove();
    db.ref('pollStatus').set({ open: true, round: newRound });
    alert("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÇ‡∏û‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
  }
}

function showAdminResults(){
  hideAll(); document.getElementById('adminResults').style.display='block';
  displayResults('team','adminResultTeam');
  displayResults('solo','adminResultSolo');
}
function backToAdmin(){ hideAll(); document.getElementById('adminPanel').style.display='block'; }

// === ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô "‡∏Ñ‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ" ===
function trackOnlineUsers() {
  const userRef = db.ref('onlineUsers/' + generateUserId());
  const connectedRef = db.ref('.info/connected');
  connectedRef.on('value', (snap) => {
    if (snap.val() === true) {
      userRef.set(true);
      userRef.onDisconnect().remove();
    }
  });

  const countRef = db.ref('onlineUsers');
  countRef.on('value', (snapshot) => {
    const data = snapshot.val() || {};
    const count = Object.keys(data).length;
    const counter = document.getElementById('onlineCount');
    if (counter) counter.textContent = `üü¢ ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ${count} ‡∏Ñ‡∏ô`;
  });
}

function generateUserId() {
  let uid = localStorage.getItem('userSessionId');
  if (!uid) {
    uid = 'user_' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('userSessionId', uid);
  }
  return uid;
}

// === ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ poll ‡∏à‡∏≤‡∏Å Firebase ===
window.onload = () => {
  trackOnlineUsers();

  const pollRef = db.ref('pollStatus');
  pollRef.on('value', snapshot => {
    const status = snapshot.val() || { open: true, round: 0 };
    pollOpen = status.open === true;
    pollRound = status.round;

    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà ‚Üí ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏´‡∏ß‡∏ï
    const savedRound = localStorage.getItem('voteRound');
    if(savedRound !== String(pollRound)){
      localStorage.removeItem('votedTeam');
      localStorage.removeItem('votedSolo');
      localStorage.setItem('voteRound', pollRound);
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
    const pollStatusText = document.getElementById('pollStatusText');
    pollStatusText.textContent = pollOpen 
      ? "üü¢ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß" 
      : "üî¥ ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏ß‡∏ï‡∏≠‡∏¢‡∏π‡πà";
    pollStatusText.style.color = pollOpen ? "#2a9d8f" : "#e63946";

    console.log("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏´‡∏ß‡∏ï:", pollOpen ? "‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà" : "‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà", "‡∏£‡∏≠‡∏ö:", pollRound);
  });
};
</script>
</body>
</html>
